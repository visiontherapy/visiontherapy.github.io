
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CP saccades exercise</title>
  <meta name="darkreader-lock">

  <!-- <script src="xx_borrowed/alljs.php"></script> -->
  <script src="js/alljs.js"></script>
  <!-- <link rel="stylesheet" href="xx_borrowed/allcss.php" /> -->
  <link rel="stylesheet" href="css/allcss.css" />
  <link rel="stylesheet" href="css/vision.css" />
  <script src="js/darkmode.js"></script>
  <script defer src="js/settings.js"></script>
  <script defer src="js/topmenu.js"></script>

  <style>
    #saccades {
      position: relative;
      height: min(85vh, 98vw);
      width: 90vw;
      margin: 0;
      left: 50%;
      transform: translate(-50%);
      cursor: default;
      font-size: min(var(--fontsize) * 1vh, var(--fontsize) * 1vw);
      user-select: none;

    }


    #ctrlbar:has([value="redgreen"]:checked)~#saccades {

      .red {
        color: var(--tranared);
      }

      .green {
        color: var(--tranagreen);
      }

    }

    #ctrlbar:has([value="hybrid"]:checked)~#saccades {

      .red {
        background: linear-gradient(90deg, var(--tranagreen) 49%, var(--tranared) 50%);
        color: transparent;
        background-clip: text;
      }

      .green {
        background: linear-gradient(90deg, var(--tranared) 49%, var(--tranagreen) 50%);
        color: transparent;
        background-clip: text;
      }

    }

    #ctrlbar:has([value="colorful"]:checked)~#saccades .dot {
      color: var(--colorfg);
    }


    @media print {
      #saccades.midspace .dot:not(#centerpoint) {
        background: black;
        color: black;
        print-color-adjust: exact !important;
      }
    }
  </style>
</head>

<body>


  <div id="ctrlbar">

    <div><input type="checkbox" class="slider" id="darkmode" /><label class="button" for="darkmode">Dark mode</label></div>

    <button id="reload">Reload</button>

  </div>

  <div id="controls">
    <div id="settings">*SETTINGS*</div>
  
    <div class="ctrlbox">

      <div>Scale <input id="fontslider" type="range" min="0.5" max="2" value="1" step="0.1" /> <span id="fontscale"></span></div>

	<h3>Marks</h3>
	<div id="marktypes"></div>
	
	
	<h3>Colors</h3>
	<div id="mk_colors">
	<input type="checkbox" id="mk_red"><label for="mk_red">Red</label><br/>
	<input type="checkbox" id="mk_green"><label for="mk_green">Green</label><br/>
	
	</div>

    </div>
  </div>

  <div id="saccades" data-mark=""></div>


<style>
.mark {
display:inline-block;
background:#8834;
font-size: 40pt;
position:absolute;
width: 1.25em;
height: 1.25em;
line-height: 1.25em;
text-align: center;
}


#controls {
	line-height:1em;
	
	& h3 {
		margin-bottom:0.1em;
	}
}
	

#controls:has(#mk_red:checked) ~ #saccades .mark {
color:var(--tranared)
}

#controls:has(#mk_green:checked) ~ #saccades .mark {
color:var(--tranagreen);
}


#controls:has(#mk_green:checked):has(#mk_red:checked) ~ #saccades .mk_parttwo {
color:var(--tranared);
}





#marktypes {

	&.maxed .mk_row:has(input:not(:checked)) {
		opacity:0.5;
		pointer-events:none;
	}
	
	&.min .mk_row:has(input:checked) {
	opacity:0.5;
	pointer-events:none;
	}

}
</style>

<script>
let marktypes = document.querySelector("#marktypes");
let redmark = document.querySelector("#mk_red");
let greenmark = document.querySelector("#mk_green");

let sac = document.querySelector("#saccades");
let markers = {
	ucaps:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),
	lcaps:"abcdefghijklmnopqrstuvwxyz".split(""),
	alphanums: makearray(1,26)
	};

let chosen = ["ucaps"];

for (let mk of Object.keys(markers)) {
let mk_row = document.createElement("div");
mk_row.className = "mk_row";

let mk_input = document.createElement("input");
mk_input.type="checkbox";
mk_input.id="mk_"+mk;
mk_input.className = "markcheck";

let mk_label = document.createElement("label");
mk_label.htmlFor = mk_input.id;
mk_label.innerText = mk;

mk_row.append(mk_input,mk_label);
marktypes.append(mk_row);
}


marktypes.onclick = function(e) {
	if (e.target.classList.contains("markcheck")) {
		let chks = marktypes.querySelectorAll("input:checked");
		marktypes.className= "";
		if (chks.length ==2) {
		marktypes.className= "maxed";
		}
		//else if (chks.length ==1) {marktypes.className= "min";}
		chosen = [];
		
		if (chks.length >0) {
		for (let n of chks) {
			chosen.push(n.id.replace(/mk_/,""))
		}
		showchart();
		}
	}
}

// make adjustable:
// padding
// mark font size
//

function showchart() {
	sac.innerHTML = "";
	let placedmarks = [];

	let parttwo;
	if (chosen.length ==1) chosen.push(chosen[0]);
	for (let choice of chosen) {
		for (let mark of markers[choice]) {
			let m = document.createElement("div");
			m.innerText = mark;
			m.className = "mark";
			if (parttwo) m.classList.add("mk_parttwo");
			m.dataset.mark = mark;
			sac.append(m);

			placerandom(m);
		}
		parttwo = true;
	}

	function placerandom(m,counter=0) {
		m.style.left= minmax(0,95) + "%";
		m.style.top= minmax(0,90) + "%";
		let b = m.getBoundingClientRect();
		for (let p of placedmarks) {
			if (!(b.right < p.left  ||
				b.left > p.right ||
				b.bottom < p.top ||
				b.top > p.bottom)
				//console.log("no overlap, continue");	
				//} else if (
				&&
				(isbetween(b.left, p.left, p.right) || isbetween(b.right,p.left,p.right))
				&&
				(isbetween(b.top,p.top,p.bottom) || isbetween(b.bottom,p.top,p.bottom))
				) {
				if (counter<50) {
					placerandom(m,++counter);
					return;
				}
				m.style.background="#f003";
			}
		}
		placedmarks.push({left:b.left,right:b.right,top:b.top,bottom:b.bottom});
	}
}

showchart();

let m = document.querySelector(".mark");

// - check if value is between two others
// - default includes endpoints
function isbetween(num, min, max, equ = true) {
  if (equ) {
    return num >= min && num <= max;
  } else {
    return num > min && num < max;
  }
}

// - convenience function to create an array of x numbers, or an array with values between x and y
function makearray(start, end) {
  if (!end) {
    end = start - 1;
    start = 0;
  }
  return [...Array(end + 1).keys()].slice(start);
}
// makearray(3) == [0,1,2]
// makearray(5,9) == [5,6,7,8,9]

document.querySelector("#reload").onclick = function (e) {
	showchart();
};



</script>
<pre>
Issues:
- distribution density is dependent on window size and marker size
- overlap avoidance function only loops 50 times to prevent infinite loop crash
 - consider making this adjustable

</pre>
</body>

</html>
